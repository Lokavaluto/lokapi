<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>LokAPI - v0.0.19-alpha.202205031254</title><meta name="description" content="Documentation for LokAPI - v0.0.19-alpha.202205031254"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">LokAPI - v0.0.19-alpha.202205031254</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>LokAPI - v0.0.19-alpha.202205031254 </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography"><p>LokAPI is a javascript library intended to be used in mobile
applications or web application to abstract all logics with
lokavaluto&#39;s server.</p>

<a href="#adding-lokapi-to-your-project" id="adding-lokapi-to-your-project" style="color: inherit; text-decoration: none;">
  <h1>Adding <code>lokapi</code> to your project</h1>
</a>
<p>From the root of your project:</p>
<pre><code class="language-sh"><span class="hl-0">npm install --save @lokavaluto/lokapi</span>
</code></pre>
<p>Or better, as <code>@lokavaluto/lokapi</code> is still in early release,</p>
<pre><code class="language-sh"><span class="hl-0">npm install --save Lokavaluto/lokapi#master</span>
</code></pre>
<p>To be sure to get the latest version, relaunch this last command
whenever you want to update.</p>

<a href="#setting-up-lokapi" id="setting-up-lokapi" style="color: inherit; text-decoration: none;">
  <h1>Setting up <code>lokapi</code></h1>
</a>

<a href="#subclassing-main-lokapiabstract" id="subclassing-main-lokapiabstract" style="color: inherit; text-decoration: none;">
  <h2>Subclassing main LokAPIAbstract</h2>
</a>
<p>Please note that an important part of the following is already
packaged in package <code>@lokavaluto/lokapi-browser</code> (for node and browser
support), and thus allow you to quick-start your projects with less
code. Here&#39;s a link to the project page of
<a href="https://github.com/Lokavaluto/lokapi-browser">lokapi-browser</a> and how to use it, with an example.</p>
<p>Lokapi will require a way to make HTTP request, access to a permanent
store, or various other tasks. Depending on your platform or
environment, you might have different way to implement these.</p>
<p>To inject these exchangeable dependency, you are invited to subclass
LokAPIAbstract and define these objects:</p>
<p>BackendFactories :: A mapping of currency backends loaded
httpRequest :: an implementation of <code>HTTPRequest</code>
base64Encode :: a function to encode a string to base64
persistentStore :: an object implementing this interface:</p>
<pre><code class="language-typescript"><span class="hl-0">    </span><span class="hl-1">export</span><span class="hl-0"> </span><span class="hl-2">interface</span><span class="hl-0"> </span><span class="hl-3">IPersistentStore</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-4">get</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">, </span><span class="hl-5">defaultValue</span><span class="hl-0">?: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">string</span><br/><span class="hl-0">        </span><span class="hl-4">set</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">void</span><br/><span class="hl-0">        </span><span class="hl-4">del</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">void</span><br/><span class="hl-0">    }</span>
</code></pre>
<p>(optional) requestLogin :: a function to trigger a login screen when
automatic authorization fails or when no automatic autorization data
exists. This will be triggered only if a protected request is made
on the administration backend side.
(optional) requestLocalPassword :: a function for backends to
trigger a request to the user for a password that is meant
to be kept locally on the device. This is typically used before
payment with some backends (to see an example see package
<code>lokapi-backend-comchain</code>), or administrative tasks. And takes
usually the form of a popup.</p>

<a href="#instanciating-lokapi" id="instanciating-lokapi" style="color: inherit; text-decoration: none;">
  <h2>Instanciating lokapi</h2>
</a>
<p>On instantiation time, <code>LokAPI</code> class will require you to provide:</p>
<p>host :: as a <code>string</code> (example: &quot;lokavaluto.fr&quot;)</p>
<p>database :: as a <code>string</code> (example: &quot;myodoodb&quot;)</p>

<a href="#example-for-node" id="example-for-node" style="color: inherit; text-decoration: none;">
  <h3>Example for node</h3>
</a>
<p>Using node&#39;s core <code>https</code> as HTTP requestion implementation:</p>
<pre><code class="language-typescript"><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-5">http</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&quot;http&quot;</span><br/><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-5">https</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&quot;https&quot;</span><br/><br/><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-5">VueCookieNext</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&#39;vue-cookie-next&#39;</span><br/><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-5">LokAPIAbstract</span><span class="hl-0">, </span><span class="hl-5">e</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-5">LokAPIExc</span><span class="hl-0">, </span><span class="hl-5">t</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-5">LokAPIType</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&quot;@lokavaluto/lokapi&quot;</span><br/><br/><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-5">cyclos</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&#39;@lokavaluto/lokapi-backend-cyclos&#39;</span><br/><br/><br/><span class="hl-2">class</span><span class="hl-0"> </span><span class="hl-3">cookieStore</span><span class="hl-0"> </span><span class="hl-2">implements</span><span class="hl-0"> </span><span class="hl-3">LokAPIType</span><span class="hl-0">.</span><span class="hl-3">IPersistentStore</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-2">constructor</span><span class="hl-0">() {</span><br/><span class="hl-0">    </span><span class="hl-5">VueCookieNext</span><span class="hl-0">.</span><span class="hl-4">config</span><span class="hl-0">({ </span><span class="hl-5">expire:</span><span class="hl-0"> </span><span class="hl-6">&#39;7d&#39;</span><span class="hl-0"> })</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">  </span><span class="hl-4">get</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">, </span><span class="hl-5">defaultValue</span><span class="hl-0">?: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">string</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">value</span><span class="hl-0"> = </span><span class="hl-5">VueCookieNext</span><span class="hl-0">.</span><span class="hl-4">getCookie</span><span class="hl-0">(</span><span class="hl-6">&quot;lokapi_&quot;</span><span class="hl-0"> + </span><span class="hl-5">key</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-7">// XXXvlab: CookieViewNext is JSON.parsing string sometimes and this</span><br/><span class="hl-0">    </span><span class="hl-7">// breaks interface !</span><br/><span class="hl-0">    </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-5">value</span><span class="hl-0"> !== </span><span class="hl-2">null</span><span class="hl-0"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-0"> </span><span class="hl-5">value</span><span class="hl-0"> === </span><span class="hl-6">&quot;object&quot;</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-3">JSON</span><span class="hl-0">.</span><span class="hl-4">stringify</span><span class="hl-0">(</span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-5">value</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">  </span><span class="hl-4">set</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">void</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">VueCookieNext</span><span class="hl-0">.</span><span class="hl-4">setCookie</span><span class="hl-0">(</span><span class="hl-6">&quot;lokapi_&quot;</span><span class="hl-0"> + </span><span class="hl-5">key</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">  </span><span class="hl-4">del</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">void</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">VueCookieNext</span><span class="hl-0">.</span><span class="hl-4">removeCookie</span><span class="hl-0">(</span><span class="hl-6">&quot;lokapi_&quot;</span><span class="hl-0"> + </span><span class="hl-5">key</span><span class="hl-0">)</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">requesters</span><span class="hl-0">: </span><span class="hl-3">any</span><span class="hl-0"> = { </span><span class="hl-5">http</span><span class="hl-0">, </span><span class="hl-5">https</span><span class="hl-0"> }</span><br/><br/><span class="hl-2">class</span><span class="hl-0"> </span><span class="hl-3">NodeLokAPI</span><span class="hl-0"> </span><span class="hl-2">extends</span><span class="hl-0"> </span><span class="hl-3">LokApiAbstract</span><span class="hl-0"> {</span><br/><br/><span class="hl-0">    </span><span class="hl-5">BackendFactories</span><span class="hl-0"> = {</span><br/><span class="hl-0">        </span><span class="hl-5">cyclos</span><span class="hl-0">,</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-4">httpRequest</span><span class="hl-0"> = (</span><span class="hl-5">opts</span><span class="hl-0">: </span><span class="hl-3">LokAPIType</span><span class="hl-0">.</span><span class="hl-3">coreHttpOpts</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">httpsOpts</span><span class="hl-0"> = {</span><br/><span class="hl-0">            </span><span class="hl-5">host:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">host</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-5">path:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">path</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-5">method:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">method</span><span class="hl-0">,</span><br/><span class="hl-0">            ...</span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0"> &amp;&amp; { </span><span class="hl-5">headers:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0"> },</span><br/><span class="hl-0">            ...</span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">port</span><span class="hl-0"> &amp;&amp; { </span><span class="hl-5">port:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">port</span><span class="hl-0"> }</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">        </span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">requester</span><span class="hl-0"> = </span><span class="hl-5">requesters</span><span class="hl-0">[</span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">protocol</span><span class="hl-0">]</span><br/><span class="hl-0">        </span><span class="hl-1">if</span><span class="hl-0"> (!</span><span class="hl-5">requester</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-1">throw</span><span class="hl-0"> </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-3">Error</span><span class="hl-0">(</span><span class="hl-6">`Protocol </span><span class="hl-2">${</span><span class="hl-5">opts</span><span class="hl-9">.</span><span class="hl-5">protocol</span><span class="hl-2">}</span><span class="hl-6"> unsupported by this implementation`</span><span class="hl-0">)</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">        </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-3">Promise</span><span class="hl-0">((</span><span class="hl-5">resolve</span><span class="hl-0">, </span><span class="hl-5">reject</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">req</span><span class="hl-0"> = </span><span class="hl-5">requester</span><span class="hl-0">.</span><span class="hl-4">request</span><span class="hl-0">(</span><span class="hl-5">httpsOpts</span><span class="hl-0">, (</span><span class="hl-5">res</span><span class="hl-0">: </span><span class="hl-3">any</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">                </span><span class="hl-2">const</span><span class="hl-0"> { </span><span class="hl-8">statusCode</span><span class="hl-0"> } = </span><span class="hl-5">res</span><br/><br/><span class="hl-0">                </span><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">rawData</span><span class="hl-0"> = </span><span class="hl-6">&#39;&#39;</span><br/><br/><span class="hl-0">                </span><span class="hl-5">res</span><span class="hl-0">.</span><span class="hl-4">on</span><span class="hl-0">(</span><span class="hl-6">&#39;data&#39;</span><span class="hl-0">, (</span><span class="hl-5">chunk</span><span class="hl-0">: </span><span class="hl-3">any</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> { </span><span class="hl-5">rawData</span><span class="hl-0"> += </span><span class="hl-5">chunk</span><span class="hl-0"> })</span><br/><span class="hl-0">                </span><span class="hl-5">res</span><span class="hl-0">.</span><span class="hl-4">on</span><span class="hl-0">(</span><span class="hl-6">&#39;end&#39;</span><span class="hl-0">, () </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">                    </span><span class="hl-1">if</span><span class="hl-0"> (!</span><span class="hl-5">statusCode</span><span class="hl-0"> || </span><span class="hl-5">statusCode</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">().</span><span class="hl-4">slice</span><span class="hl-0">(</span><span class="hl-10">0</span><span class="hl-0">, </span><span class="hl-10">1</span><span class="hl-0">) !== </span><span class="hl-6">&#39;2&#39;</span><span class="hl-0">) {</span><br/><span class="hl-0">                        </span><span class="hl-5">res</span><span class="hl-0">.</span><span class="hl-4">resume</span><span class="hl-0">();</span><br/><span class="hl-0">                        </span><span class="hl-4">reject</span><span class="hl-0">(</span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-5">LokAPIExc</span><span class="hl-0">.</span><span class="hl-4">HttpError</span><span class="hl-0">(</span><span class="hl-5">statusCode</span><span class="hl-0">, </span><span class="hl-5">res</span><span class="hl-0">.</span><span class="hl-5">statusMessage</span><span class="hl-0">, </span><span class="hl-5">rawData</span><span class="hl-0">, </span><span class="hl-5">res</span><span class="hl-0">))</span><br/><span class="hl-0">                        </span><span class="hl-1">return</span><br/><span class="hl-0">                    } </span><span class="hl-1">else</span><span class="hl-0"> {</span><br/><span class="hl-0">                        </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">responseHeaders</span><span class="hl-0">) {</span><br/><span class="hl-0">                            </span><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">header</span><span class="hl-0"> </span><span class="hl-2">in</span><span class="hl-0"> </span><span class="hl-5">res</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0">) {</span><br/><span class="hl-0">                                </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">responseHeaders</span><span class="hl-0">[</span><span class="hl-5">header</span><span class="hl-0">] = </span><span class="hl-5">res</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0">[</span><span class="hl-5">header</span><span class="hl-0">]</span><br/><span class="hl-0">                            }</span><br/><span class="hl-0">                        }</span><br/><span class="hl-0">                        </span><span class="hl-4">resolve</span><span class="hl-0">(</span><span class="hl-5">rawData</span><span class="hl-0">)</span><br/><span class="hl-0">                    }</span><br/><span class="hl-0">                })</span><br/><span class="hl-0">            })</span><br/><br/><span class="hl-0">            </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">data</span><span class="hl-0">) {</span><br/><span class="hl-0">                </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">typeof</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">data</span><span class="hl-0"> !== </span><span class="hl-6">&quot;string&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">                    </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">data</span><span class="hl-0"> = </span><span class="hl-3">JSON</span><span class="hl-0">.</span><span class="hl-4">stringify</span><span class="hl-0">(</span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">data</span><span class="hl-0">)</span><br/><span class="hl-0">                </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-4">write</span><span class="hl-0">(</span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">data</span><span class="hl-0">)</span><br/><span class="hl-0">            }</span><br/><span class="hl-0">            </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-4">end</span><span class="hl-0">()</span><br/><span class="hl-0">            </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-4">on</span><span class="hl-0">(</span><span class="hl-6">&#39;error&#39;</span><span class="hl-0">, (</span><span class="hl-5">err</span><span class="hl-0">: </span><span class="hl-3">any</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">                </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">error</span><span class="hl-0">(</span><span class="hl-6">`Encountered an error trying to make a request: </span><span class="hl-2">${</span><span class="hl-5">err</span><span class="hl-9">.</span><span class="hl-5">message</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">);</span><br/><span class="hl-0">                </span><span class="hl-4">reject</span><span class="hl-0">(</span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-5">LokAPIExc</span><span class="hl-0">.</span><span class="hl-4">RequestFailed</span><span class="hl-0">(</span><span class="hl-5">err</span><span class="hl-0">.</span><span class="hl-5">message</span><span class="hl-0">))</span><br/><span class="hl-0">            })</span><br/><span class="hl-0">        })</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-4">base64Encode</span><span class="hl-0"> = (</span><span class="hl-5">s</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-5">Buffer</span><span class="hl-0">.</span><span class="hl-4">from</span><span class="hl-0">(</span><span class="hl-5">s</span><span class="hl-0">).</span><span class="hl-4">toString</span><span class="hl-0">(</span><span class="hl-6">&#39;base64&#39;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">persistentStore</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">cookieStore</span><span class="hl-0">()</span><br/><span class="hl-0">}</span><br/><br/><br/><span class="hl-1">if</span><span class="hl-0"> (!</span><span class="hl-5">process</span><span class="hl-0">.</span><span class="hl-5">env</span><span class="hl-0">.</span><span class="hl-8">VUE_APP_LOKAPI_HOST</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-1">throw</span><span class="hl-0"> </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-3">Error</span><span class="hl-0">(</span><span class="hl-6">&quot;Please specify VUE_APP_LOKAPI_HOST in &#39;.env&#39;&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><br/><br/><span class="hl-1">if</span><span class="hl-0"> (!</span><span class="hl-5">process</span><span class="hl-0">.</span><span class="hl-5">env</span><span class="hl-0">.</span><span class="hl-8">VUE_APP_LOKAPI_DB</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-1">throw</span><span class="hl-0"> </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-3">Error</span><span class="hl-0">(</span><span class="hl-6">&quot;Please specify VUE_APP_LOKAPI_DB in &#39;.env&#39;&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><br/><br/><span class="hl-2">var</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">LokAPI</span><span class="hl-0">(</span><br/><span class="hl-0">    </span><span class="hl-5">process</span><span class="hl-0">.</span><span class="hl-5">env</span><span class="hl-0">.</span><span class="hl-8">VUE_APP_LOKAPI_HOST</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">process</span><span class="hl-0">.</span><span class="hl-5">env</span><span class="hl-0">.</span><span class="hl-8">VUE_APP_LOKAPI_DB</span><span class="hl-0">,</span><br/><span class="hl-0">)</span>
</code></pre>

<a href="#example-for-nativescript" id="example-for-nativescript" style="color: inherit; text-decoration: none;">
  <h3>Example for <code>nativescript</code></h3>
</a>
<p>Using <code>@nativescript-community/https</code> as HTTP request implementation:</p>
<p>Note that this example couldn&#39;t be thoroughly tested as much as
it should. Use with caution.</p>
<pre><code class="language-typescript"><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-2">*</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-5">https</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&#39;@nativescript-community/https&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-5">LokAPIAbstract</span><span class="hl-0">, </span><span class="hl-5">e</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-5">LokAPIExc</span><span class="hl-0">, </span><span class="hl-5">t</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-5">LokAPIType</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&quot;@lokavaluto/lokapi&quot;</span><br/><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-5">getString</span><span class="hl-0">, </span><span class="hl-5">remove</span><span class="hl-0"> </span><span class="hl-1">as</span><span class="hl-0"> </span><span class="hl-5">removeSetting</span><span class="hl-0">, </span><span class="hl-5">setString</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&#39;@nativescript/core/application-settings&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><span class="hl-1">import</span><span class="hl-0"> </span><span class="hl-5">cyclos</span><span class="hl-0"> </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-6">&#39;@lokavaluto/lokapi-backend-cyclos&#39;</span><br/><br/><br/><span class="hl-0">  </span><span class="hl-2">class</span><span class="hl-0"> </span><span class="hl-3">applicationSetting</span><span class="hl-0"> </span><span class="hl-2">implements</span><span class="hl-0"> </span><span class="hl-3">LokAPIType</span><span class="hl-0">.</span><span class="hl-3">IPersistentStore</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">get</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">, </span><span class="hl-5">defaultValue</span><span class="hl-0">?: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">string</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-4">getString</span><span class="hl-0">(</span><span class="hl-6">&quot;lokapi_&quot;</span><span class="hl-0"> + </span><span class="hl-5">key</span><span class="hl-0">, </span><span class="hl-5">defaultValue</span><span class="hl-0">)</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">      </span><span class="hl-4">set</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">void</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-4">setString</span><span class="hl-0">(</span><span class="hl-6">&quot;lokapi_&quot;</span><span class="hl-0"> + </span><span class="hl-5">key</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">      </span><span class="hl-4">del</span><span class="hl-0">(</span><span class="hl-5">key</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">): </span><span class="hl-3">void</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-4">removeSetting</span><span class="hl-0">(</span><span class="hl-6">&quot;lokapi_&quot;</span><span class="hl-0"> + </span><span class="hl-5">key</span><span class="hl-0">)</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">  }</span><br/><br/><br/><span class="hl-0">  </span><span class="hl-2">class</span><span class="hl-0"> </span><span class="hl-3">NativeLokAPI</span><span class="hl-0"> </span><span class="hl-2">extends</span><span class="hl-0"> </span><span class="hl-3">LokAPIAbstract</span><span class="hl-0"> {</span><br/><br/><span class="hl-0">      </span><span class="hl-5">BackendFactories</span><span class="hl-0"> = {</span><br/><span class="hl-0">          </span><span class="hl-5">cyclos</span><span class="hl-0">,</span><br/><span class="hl-0">      }</span><br/><br/><span class="hl-0">      </span><span class="hl-4">httpRequest</span><span class="hl-0"> = </span><span class="hl-2">async</span><span class="hl-0"> (</span><span class="hl-5">opts</span><span class="hl-0">: </span><span class="hl-3">LokAPIType</span><span class="hl-0">.</span><span class="hl-3">coreHttpOpts</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">nativeRequestOpts</span><span class="hl-0"> = {</span><br/><span class="hl-0">              </span><span class="hl-5">url:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">protocol</span><span class="hl-0"> + </span><span class="hl-6">&quot;://&quot;</span><span class="hl-0"> + </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">host</span><span class="hl-0"> + </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">path</span><span class="hl-0">,</span><br/><span class="hl-0">              </span><span class="hl-5">method:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">method</span><span class="hl-0">,</span><br/><span class="hl-0">              </span><span class="hl-5">headers:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0">,</span><br/><span class="hl-0">              </span><span class="hl-5">body:</span><span class="hl-0"> </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">data</span><span class="hl-0">,</span><br/><span class="hl-0">              </span><span class="hl-5">useLegacy:</span><span class="hl-0"> </span><span class="hl-2">true</span><span class="hl-0">,</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">          </span><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">response</span><br/><span class="hl-0">          </span><span class="hl-1">try</span><span class="hl-0"> {</span><br/><span class="hl-0">              </span><span class="hl-5">response</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">https</span><span class="hl-0">.</span><span class="hl-4">request</span><span class="hl-0">(</span><span class="hl-5">nativeRequestOpts</span><span class="hl-0">)</span><br/><span class="hl-0">          } </span><span class="hl-1">catch</span><span class="hl-0"> (</span><span class="hl-5">err</span><span class="hl-0">) {</span><br/><span class="hl-0">              </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">error</span><span class="hl-0">(</span><br/><span class="hl-0">                  </span><span class="hl-6">`Encountered an error trying to make a request: </span><span class="hl-2">${</span><span class="hl-5">err</span><span class="hl-9">.</span><span class="hl-5">message</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">)</span><br/><span class="hl-0">              </span><span class="hl-1">throw</span><span class="hl-0"> </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-5">LokAPIExc</span><span class="hl-0">.</span><span class="hl-4">RequestFailed</span><span class="hl-0">(</span><span class="hl-5">err</span><span class="hl-0">.</span><span class="hl-5">message</span><span class="hl-0">)</span><br/><span class="hl-0">          }</span><br/><br/><span class="hl-0">          </span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">statusCode</span><span class="hl-0"> = </span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-5">statusCode</span><span class="hl-0">;</span><br/><span class="hl-0">          </span><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">rawData</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-5">content</span><span class="hl-0">.</span><span class="hl-4">toStringAsync</span><span class="hl-0">();</span><br/><br/><span class="hl-0">          </span><span class="hl-1">if</span><span class="hl-0"> (!</span><span class="hl-5">statusCode</span><span class="hl-0"> || </span><span class="hl-5">statusCode</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">().</span><span class="hl-4">slice</span><span class="hl-0">(</span><span class="hl-10">0</span><span class="hl-0">, </span><span class="hl-10">1</span><span class="hl-0">) !== </span><span class="hl-6">&#39;2&#39;</span><span class="hl-0">) {</span><br/><span class="hl-0">              </span><span class="hl-1">throw</span><span class="hl-0"> </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-5">LokAPIExc</span><span class="hl-0">.</span><span class="hl-4">HttpError</span><span class="hl-0">(</span><span class="hl-5">statusCode</span><span class="hl-0">, </span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-5">reason</span><span class="hl-0">, </span><span class="hl-6">&quot;&quot;</span><span class="hl-0">, </span><span class="hl-5">response</span><span class="hl-0">)</span><br/><span class="hl-0">          }</span><br/><br/><span class="hl-0">          </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">responseHeaders</span><span class="hl-0">) {</span><br/><span class="hl-0">              </span><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">header</span><span class="hl-0"> </span><span class="hl-2">in</span><span class="hl-0"> </span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0">) {</span><br/><span class="hl-0">                  </span><span class="hl-5">opts</span><span class="hl-0">.</span><span class="hl-5">responseHeaders</span><span class="hl-0">[</span><span class="hl-5">header</span><span class="hl-0">] = </span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0">[</span><span class="hl-5">header</span><span class="hl-0">]</span><br/><span class="hl-0">              }</span><br/><span class="hl-0">          }</span><br/><br/><span class="hl-0">          </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-5">rawData</span><br/><span class="hl-0">      }</span><br/><br/><span class="hl-0">      </span><span class="hl-5">base64Encode</span><span class="hl-0"> = </span><span class="hl-5">base64Encode</span><br/><span class="hl-0">      </span><span class="hl-5">persistentStore</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">applicationSetting</span><span class="hl-0">()</span><br/><span class="hl-0">  }</span><br/><br/><br/><span class="hl-0">  </span><span class="hl-2">var</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">NativeLokAPI</span><span class="hl-0">(</span><span class="hl-8">APP_HOST</span><span class="hl-0">, </span><span class="hl-8">APP_DB</span><span class="hl-0">)</span><br/>
</code></pre>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h1>Usage</h1>
</a>

<a href="#basic-usage" id="basic-usage" style="color: inherit; text-decoration: none;">
  <h2>Basic usage</h2>
</a>

<a href="#login" id="login" style="color: inherit; text-decoration: none;">
  <h3>Login</h3>
</a>
<p>You must log in to the server with an existing Odoo Lokavaluto
account:</p>
<pre><code class="language-typescript"><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokApi</span><span class="hl-0">.</span><span class="hl-4">login</span><span class="hl-0">(</span><span class="hl-6">&quot;myuser&quot;</span><span class="hl-0">, </span><span class="hl-6">&quot;mypassword&quot;</span><span class="hl-0">)</span>
</code></pre>

<a href="#accessing-accounts" id="accessing-accounts" style="color: inherit; text-decoration: none;">
  <h3>Accessing accounts</h3>
</a>
<p>We assume that you&#39;ve instanciated <code>LokAPI</code> as stated in the previous
section, and you have logged in.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">accounts</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getAccounts</span><span class="hl-0">()</span><br/><br/><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">balance</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">accounts</span><span class="hl-0">[</span><span class="hl-10">0</span><span class="hl-0">].</span><span class="hl-4">getBalance</span><span class="hl-0">()</span><br/><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">symbol</span><span class="hl-0">= </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">accounts</span><span class="hl-0">[</span><span class="hl-10">0</span><span class="hl-0">].</span><span class="hl-4">getSymbol</span><span class="hl-0">()</span><br/><br/><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`balance in first account: </span><span class="hl-2">${</span><span class="hl-5">balance</span><span class="hl-2">}</span><span class="hl-6"> </span><span class="hl-2">${</span><span class="hl-5">symbol</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">)</span>
</code></pre>
<ul>
<li><p><code>backend.getAccounts()</code> is the list of accounts in that connection
(warning, this is a promise).</p>
</li>
<li><p><code>account.getBalance()</code> is the balance of the account</p>
</li>
<li><p><code>account.getSymbol()</code> is the currency symbol for the account</p>
</li>
</ul>

<a href="#crediting-account" id="crediting-account" style="color: inherit; text-decoration: none;">
  <h3>Crediting account</h3>
</a>
<p>You can credit your account thanks to <code>account.getCreditUrl(amount)</code>.
This will return an url to finish the purchase of new credits.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">accounts</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getAccounts</span><span class="hl-0">()</span><br/><br/><span class="hl-5">url</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">accounts</span><span class="hl-0">[</span><span class="hl-10">0</span><span class="hl-0">].</span><span class="hl-4">getCreditUrl</span><span class="hl-0">(</span><span class="hl-10">100</span><span class="hl-0">)</span><br/><br/><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`I need to follow instructions on $url `</span><span class="hl-0"> +</span><br/><span class="hl-0">            </span><span class="hl-6">&#39;to purchase credit to store in my account.&#39;</span><span class="hl-0">)</span>
</code></pre>
<p>Note that depending on the backend, an admin might have to
manually validate the final step of crediting the money on
your account.</p>

<a href="#looking-for-recipients" id="looking-for-recipients" style="color: inherit; text-decoration: none;">
  <h3>Looking for recipients</h3>
</a>
<p>Recipients are possible receiving end of a transfer of
money. These are connected to contacts in <code>lokapi</code>.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">searchRecipients</span><span class="hl-0">(</span><span class="hl-6">&quot;Alain&quot;</span><span class="hl-0">)</span><br/><br/><span class="hl-5">recipients</span><span class="hl-0">.</span><span class="hl-4">forEach</span><span class="hl-0">(</span><span class="hl-5">recipient</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`name: </span><span class="hl-2">${</span><span class="hl-5">recipient</span><span class="hl-9">.</span><span class="hl-5">name</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">)</span><br/><span class="hl-0">})</span>
</code></pre>
<p>Note that if you look for an empty string,
<code>lokAPI.searchRecipients(&quot;&quot;)</code> will return all favorite recipients.</p>
<p>Recipients are always ordered with favorites first and by name.</p>
<p>You can also grab recipients by url. This url is the identity
url created by odoo. It&#39;ll return a list of recipients, one
for each backend you can use to send money.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">url</span><span class="hl-0"> = </span><span class="hl-6">&quot;https://myhost.com/fr_FR/partners/foo-bar-13&quot;</span><br/><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getRecipientsFromUrl</span><span class="hl-0">(</span><span class="hl-5">url</span><span class="hl-0">)</span><br/><br/><span class="hl-5">recipients</span><span class="hl-0">.</span><span class="hl-4">forEach</span><span class="hl-0">(</span><span class="hl-5">recipient</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`name: </span><span class="hl-2">${</span><span class="hl-5">recipient</span><span class="hl-9">.</span><span class="hl-5">name</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">)</span><br/><span class="hl-0">})</span>
</code></pre>

<a href="#transfer-money-between-an-account-to-a-recipient" id="transfer-money-between-an-account-to-a-recipient" style="color: inherit; text-decoration: none;">
  <h3>Transfer money between an account to a recipient</h3>
</a>
<p>Transfering money is done from an account of the logged-in user
to a recipient:</p>
<pre><code class="language-typescript"><span class="hl-7">// Fetch recipients named &#39;Alain&#39;</span><br/><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">searchRecipients</span><span class="hl-0">(</span><span class="hl-6">&quot;Alain&quot;</span><span class="hl-0">)</span><br/><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0">[</span><span class="hl-10">0</span><span class="hl-0">].</span><span class="hl-4">transfer</span><span class="hl-0">(</span><span class="hl-6">&quot;12&quot;</span><span class="hl-0">, </span><span class="hl-6">&quot;Dinner Party participation&quot;</span><span class="hl-0">)</span>
</code></pre>
<p>Note that <code>.transfer(..)</code> can lead to these exceptions to be thrown:</p>
<ul>
<li>sub-classes of <code>InvalidAmount</code></li>
<li><code>NegativeAmount</code>: Upon negative amounts</li>
<li><code>NullAmount</code>: Upon 0 amount</li>
<li><code>RefusedAmount</code>: When the backend refuses the transaction (often
linked to insufficient funds).</li>
<li><code>InactiveAccount</code>: Source or destination account is inactive.</li>
</ul>

<a href="#requesting-contact-info-on-current-logged-in-user" id="requesting-contact-info-on-current-logged-in-user" style="color: inherit; text-decoration: none;">
  <h3>Requesting contact info on current logged in user</h3>
</a>
<p>The method <code>lokAPI.getMyContact()</code> allows you to get back
your own information.:</p>
<pre><code class="language-typescript"><span class="hl-7">// My own information</span><br/><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">me</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getMyContact</span><span class="hl-0">()</span><br/><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`My user name: </span><span class="hl-2">${</span><span class="hl-5">me</span><span class="hl-9">.</span><span class="hl-5">name</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">)</span><br/>
</code></pre>

<a href="#settingunsetting-favorite-status-of-a-contact" id="settingunsetting-favorite-status-of-a-contact" style="color: inherit; text-decoration: none;">
  <h3>Setting/Unsetting Favorite status of a contact</h3>
</a>
<p>You can set or unset the &quot;favorite&quot; state of a given contact with the
<code>lokAPI.setFavorite(..)</code>, <code>lokAPI.unsetFavorite(..)</code>, or
<code>lokAPI.toggleFavorite(..)</code> method. This can be used on a recipient
(from <code>.searchRecipients()</code>) or a contact (but for now, only
<code>.getMyContact()</code> is outputting a contact, and it doesn&#39;t make
sense to be your own favorite, does it ?).</p>
<p>It&#39;ll not return any value, but the contact will be updated
accordingly.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">searchRecipients</span><span class="hl-0">(</span><span class="hl-6">&quot;Alain&quot;</span><span class="hl-0">)</span><br/><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0">[</span><span class="hl-10">2</span><span class="hl-0">].</span><span class="hl-4">setFavorite</span><span class="hl-0">()</span><br/><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0">[</span><span class="hl-10">3</span><span class="hl-0">].</span><span class="hl-4">unsetFavorite</span><span class="hl-0">()</span><br/><br/><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-5">recipients</span><span class="hl-0">[</span><span class="hl-10">3</span><span class="hl-0">].</span><span class="hl-5">is_favorite</span><span class="hl-0">) </span><span class="hl-7">// is expected to be unset</span><br/>
</code></pre>

<a href="#list-transactions" id="list-transactions" style="color: inherit; text-decoration: none;">
  <h3>List transactions</h3>
</a>
<p>List past transactions for the current logged in user.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">transactions</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getTransactions</span><span class="hl-0">()</span><br/><br/><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">tr</span><span class="hl-0"> </span><span class="hl-2">of</span><span class="hl-0"> </span><span class="hl-5">transactions</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`  </span><span class="hl-2">${</span><span class="hl-5">tr</span><span class="hl-9">.</span><span class="hl-5">date</span><span class="hl-2">}</span><span class="hl-6"> </span><span class="hl-2">${</span><span class="hl-5">tr</span><span class="hl-9">.</span><span class="hl-5">amount</span><span class="hl-2">}</span><span class="hl-6"> </span><span class="hl-2">${</span><span class="hl-5">tr</span><span class="hl-9">.</span><span class="hl-5">currency</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">)</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#advanced-usage" id="advanced-usage" style="color: inherit; text-decoration: none;">
  <h2>Advanced usage</h2>
</a>

<a href="#list-backends-instances" id="list-backends-instances" style="color: inherit; text-decoration: none;">
  <h3>list backends instances</h3>
</a>
<p>Lokapi provides advanced backend actions directly on it&#39;s backend&#39;s
instances. You can list them with cached, debounced, async call
<code>lokAPI.getBackends()</code>.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">backends</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getBackends</span><span class="hl-0">()</span><br/><br/><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">backend</span><span class="hl-0"> </span><span class="hl-2">of</span><span class="hl-0"> </span><span class="hl-5">backends</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`  </span><span class="hl-2">${</span><span class="hl-5">backend</span><span class="hl-9">.</span><span class="hl-5">internalId</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">)</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#requesting-the-creation-of-a-new-user-account" id="requesting-the-creation-of-a-new-user-account" style="color: inherit; text-decoration: none;">
  <h3>Requesting the creation of a new user account</h3>
</a>
<p>If you don&#39;t already have a money account, some backends will allow
you to submit a money account creation request. Once accepted by an
admin, you&#39;ll be able to use it.</p>
<p>This is done directly on the backend object thanks to
<code>IBackend.createUserAccount(data)</code>, provided that the backend
implements this.</p>
<p>Argument of <code>IBackend.createUserAccount(data)</code> is a simple object
whose content depends on the backend. Please refer to the target
backend documentation to provide the correct information.</p>

<a href="#admin" id="admin" style="color: inherit; text-decoration: none;">
  <h2>Admin</h2>
</a>
<p>These are usage for users having special administrative rights
on the <em>administrative backends</em> or the <em>currency backends</em>.</p>

<a href="#validate-account-creation-requests" id="validate-account-creation-requests" style="color: inherit; text-decoration: none;">
  <h3>Validate account creation requests</h3>
</a>
<p>Users can request the creation of a new bank account via
<code>IBackend.createUserAccount(..)</code>, provided that the backend
implements this.</p>

<a href="#check-user-account-validation-rights" id="check-user-account-validation-rights" style="color: inherit; text-decoration: none;">
  <h4>Check user account validation rights</h4>
</a>
<p>The call to <code>.hasUserAccountValidationRights()</code> will return a boolean
to tell you if any backends has at least one of their user accounts
with <code>Account Validation</code> rights.</p>
<p>Please note that this function is available on top-level <code>lokApi</code>
instance, and also on <code>Backend</code>&#39;s instances (it&#39;ll only check for
rights in its own user accounts), and finally directly on each
<code>UserAccount</code> instances.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">hasRights</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">hasUserAccountValidationRights</span><span class="hl-0">()</span><br/><br/><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-5">hasRights</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">&quot;I&#39;ve got the power !&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#get-list-of-account-waiting-for-validation" id="get-list-of-account-waiting-for-validation" style="color: inherit; text-decoration: none;">
  <h4>Get list of account waiting for validation</h4>
</a>
<p><code>.getStagingUserAccounts()</code> on main instance will query
administrative backend for the list of user account created that needs
validation from an administrative account.</p>
<p>Please note that it returns <code>IRecipient</code> objects, that allows you
to print names.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getStagingUserAccounts</span><span class="hl-0">()</span><br/><br/><span class="hl-5">recipients</span><span class="hl-0">.</span><span class="hl-4">forEach</span><span class="hl-0">(</span><span class="hl-5">recipient</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`</span><span class="hl-2">${</span><span class="hl-5">recipient</span><span class="hl-9">.</span><span class="hl-5">name</span><span class="hl-2">}</span><span class="hl-6"> has created his account and awaits validation.`</span><span class="hl-0">)</span><br/><span class="hl-0">})</span>
</code></pre>

<a href="#validate-account-creation" id="validate-account-creation" style="color: inherit; text-decoration: none;">
  <h4>Validate account creation</h4>
</a>
<p><code>.validateCreation()</code> upon a recipient instance will request the
validation of that account. The current user logged in need to have
user account validation rights.</p>
<p>Depending on the backend, it could have to check your identity or your
credentials.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">recipients</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getStagingUserAccounts</span><span class="hl-0">()</span><br/><br/><span class="hl-5">recipients</span><span class="hl-0">.</span><span class="hl-4">forEach</span><span class="hl-0">(</span><span class="hl-5">recipient</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">recipient</span><span class="hl-0">.</span><span class="hl-4">validateCreation</span><span class="hl-0">()</span><br/><span class="hl-0">})</span>
</code></pre>

<a href="#validate-credit-requests" id="validate-credit-requests" style="color: inherit; text-decoration: none;">
  <h3>Validate credit requests</h3>
</a>
<p>Credit requests (the action of requesting to get some additional
credit on your account) can be issued indirectly by the administrative
backend. There are no direct method on LokAPI to create a credit
request.</p>

<a href="#check-credit-requests-validation-rights" id="check-credit-requests-validation-rights" style="color: inherit; text-decoration: none;">
  <h4>Check credit requests validation rights</h4>
</a>
<p>The call to <code>.hasCreditRequestValidationRights()</code> will return a
boolean to tell you if any backends has at least one of their user
accounts with <code>Credit Request Validation</code> rights.</p>
<p>Please note that this method is available on top-level <code>lokApi</code>
instance, and also on <code>Backend</code>&#39;s instances (it&#39;ll only check for
rights in its own user accounts), and finally directly on each
<code>UserAccount</code> instances.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">hasRights</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">hasCreditRequestValidationRights</span><span class="hl-0">()</span><br/><br/><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-5">hasRights</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">&quot;I&#39;ve got the power !&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#get-list-of-credit-requests-waiting-for-validation" id="get-list-of-credit-requests-waiting-for-validation" style="color: inherit; text-decoration: none;">
  <h4>Get list of credit requests waiting for validation</h4>
</a>
<p><code>.getCreditRequests()</code> on main instance will query administrative
backend for the list of credit requests that needs validation
from an administrative account.</p>
<p>Please note that it returns <code>ICreditRequest</code> objects, allowing you
to query the recipient requesting the credit, and the amount.</p>
<p>Note that <code>ICreditRequest</code> are <code>ITransactions</code>, so you can expect
the same properties (<code>amount</code>, <code>relatedUser</code>, <code>currency</code>, ...)</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">creditRequests</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getCreditRequests</span><span class="hl-0">()</span><br/><br/><span class="hl-5">creditRequests</span><span class="hl-0">.</span><span class="hl-4">forEach</span><span class="hl-0">(</span><span class="hl-5">creditRequest</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`</span><span class="hl-2">${</span><span class="hl-5">creditRequest</span><span class="hl-9">.</span><span class="hl-5">relatedUser</span><span class="hl-2">}</span><span class="hl-6"> has requested a credit of </span><span class="hl-2">${</span><span class="hl-5">creditRequest</span><span class="hl-9">.</span><span class="hl-5">amount</span><span class="hl-2">}</span><span class="hl-6">.`</span><span class="hl-0">)</span><br/><span class="hl-0">})</span>
</code></pre>

<a href="#validate-credit-request" id="validate-credit-request" style="color: inherit; text-decoration: none;">
  <h4>Validate credit request</h4>
</a>
<p><code>.validate()</code> upon a credit request instance will send the validation
of that credit request (and thus credit the account with the given
amount). The current user logged in need to have credit request
validation rights.</p>
<p>Depending on the backend, you might have to confirm your identity or
your credentials.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">creditRequests</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getCreditRequests</span><span class="hl-0">()</span><br/><br/><span class="hl-5">creditRequests</span><span class="hl-0">.</span><span class="hl-4">forEach</span><span class="hl-0">(</span><span class="hl-5">creditRequest</span><span class="hl-0"> </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">creditRequest</span><span class="hl-0">.</span><span class="hl-4">validate</span><span class="hl-0">()</span><br/><span class="hl-0">})</span>
</code></pre>

<a href="#miscellaneous-and-internal-helpers" id="miscellaneous-and-internal-helpers" style="color: inherit; text-decoration: none;">
  <h2>Miscellaneous and internal helpers</h2>
</a>

<a href="#get-the-backend-list" id="get-the-backend-list" style="color: inherit; text-decoration: none;">
  <h3>Get the backend list</h3>
</a>
<p>You can query the <code>lokapi</code> to get the backend list available on the
administration backend side. A Backend instance is the main object
whose instance is responsible for a currency domain. You have a
Backend per currency. So in short, <code>.getBackends()</code> will give you
the available currencies available.</p>
<p>This function is cached, so it doesn&#39;t get updated if you happen
to add a new currency backend in the administration backend.</p>
<p><code>.getBackends()</code> returns an Object mapping a string identifier for the
backend (ie: <code>cyclos:cyclos.example.com</code>, <code>comchain:Lemanopolis</code>, ...), and
the Backend object instance.</p>
<pre><code class="language-typescript"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-5">backends</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">getBackends</span><span class="hl-0">()</span><br/><br/><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-8">b</span><span class="hl-0"> </span><span class="hl-2">in</span><span class="hl-0"> </span><span class="hl-5">backends</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-6">`  Backend </span><span class="hl-2">${</span><span class="hl-5">b</span><span class="hl-2">}</span><span class="hl-6">:`</span><span class="hl-0">, </span><span class="hl-5">backends</span><span class="hl-0">[</span><span class="hl-5">b</span><span class="hl-0">])</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#direct-request-to-odoo-api" id="direct-request-to-odoo-api" style="color: inherit; text-decoration: none;">
  <h3>Direct request to odoo api</h3>
</a>
<p>You can use <code>lokapi</code> instance to query directly the odoo api trough
the <code>get</code>, <code>post</code>, <code>put</code>, <code>delete</code> methods and their authenticated
counterparts, <code>$get</code>, <code>$post</code>, <code>$put</code>, <code>$delete</code>.</p>
<pre><code class="language-typescript"><span class="hl-7">// All 8 methods have this signature:</span><br/><span class="hl-7">// type restMethod = (path: string, data?: JsonData, headers?: { [label: string]: string }): Promise&lt;JsonData&gt;</span><br/><br/><span class="hl-7">// Notice that the next call is an example, but you don&#39;t need to</span><br/><span class="hl-7">// use this endpoint as it is used by the lokAPI.login() and</span><br/><span class="hl-7">// manages token for you.</span><br/><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">post</span><span class="hl-0">(</span><span class="hl-6">&#39;/auth/authenticate&#39;</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-5">api_version:</span><span class="hl-0"> </span><span class="hl-10">2</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-5">db:</span><span class="hl-0"> </span><span class="hl-6">&#39;mydb&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-5">params:</span><span class="hl-0"> [</span><span class="hl-6">&#39;lcc_app&#39;</span><span class="hl-0">]</span><br/><span class="hl-0">}, {</span><br/><span class="hl-0">  </span><span class="hl-6">&#39;Authorization&#39;</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-6">&#39;XYZ&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">})</span><br/><br/><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">$post</span><span class="hl-0">(</span><span class="hl-6">`/partner/</span><span class="hl-2">${</span><span class="hl-5">userId</span><span class="hl-2">}</span><span class="hl-6">`</span><span class="hl-0">)</span><br/><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">$put</span><span class="hl-0">(</span><span class="hl-6">`/partner/</span><span class="hl-2">${</span><span class="hl-5">userId</span><span class="hl-2">}</span><span class="hl-6">/favorite/set`</span><span class="hl-0">)</span><br/><span class="hl-5">lokAPI</span><span class="hl-0">.</span><span class="hl-4">$get</span><span class="hl-0">(</span><span class="hl-6">`/partner/partner_search`</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-5">value:</span><span class="hl-0"> </span><span class="hl-6">&quot;foo&quot;</span><br/><span class="hl-0">})</span>
</code></pre>
<p>Please note that <code>.get(..)</code> and <code>.$get(..)</code> have same prototype
and usage than other function and do not require you to build a query
string as it&#39;ll encode in the URL as a querystring the data you&#39;ve
provided.</p>

<a href="#changelog" id="changelog" style="color: inherit; text-decoration: none;">
  <h1>Changelog</h1>
</a>

<a href="#0019-alpha202205031254" id="0019-alpha202205031254" style="color: inherit; text-decoration: none;">
  <h2>0.0.19-alpha.202205031254</h2>
</a>

<a href="#new" id="new" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Provide <code>InsufficientBalance</code> exception for currency backends. [Seddik Kadi]</p>
</li>
<li><p>Add section on <code>creditRequest.validate()</code> [Valentin Lab]</p>
<p>Note that the implementation is in the backend code.</p>
</li>
<li><p>Add sections on <code>.getBackends(..)</code> and <code>IBackend.createUserAccount(..)</code> [Valentin Lab]</p>
</li>
<li><p>Add <code>.getCreditRequests(..)</code> to get list of pending credit requests. [Valentin Lab]</p>
</li>
<li><p>Add <code>.hasCreditRequestValidationRights()</code> check. [Valentin Lab]</p>
</li>
<li><p>Add <code>.validateCreation()</code> example and doc. [Valentin Lab]</p>
</li>
<li><p>Provide <code>requestLocalPassword</code> type declaration for backends. [Valentin Lab]</p>
</li>
<li><p>Provide new general exception and utility functions to be used in backends. [Valentin Lab]</p>
</li>
<li><p>Add <code>.getStagingUserAccounts()</code> to get list of newly created account awaiting for validation. [Valentin Lab]</p>
</li>
<li><p>Provide new <code>.hasUserAccountValidationRights()</code> async boolean check. [Valentin Lab]</p>
</li>
<li><p><code>LokAPI.getBackends(..)</code> is now public. [Valentin Lab]</p>
<p>This is now required as <code>Backend</code> direct access is required to
<code>Backend.createAccount(..)</code> and other <code>Backend</code> level features.</p>
</li>
<li><p>New: doc: add a reference to <code>@lokavaluto/lokapi-browser</code>&#39;s help. [Valentin Lab]</p>
</li>
</ul>

<a href="#changes" id="changes" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li>Store current user contact info from prefetch in cache state. [Valentin Lab]</li>
</ul>

<a href="#fix" id="fix" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li><p>Let 403 error on odoo backend be not treated as re-login request. [Valentin Lab]</p>
</li>
<li><p>Remove <code>searchProRecipients(..)</code> as endpoint was removed. [Valentin Lab]</p>
</li>
<li><p>Standardize backend type and accounts (api 12) [Valentin Lab]</p>
<p>The backend id identify a currency and is structured as this
<code>&lt;BACKEND&gt;:&lt;IDCURRENCY&gt;</code>. It is to the backend discretion to
make sens of IDCURRENCY. The BACKEND part is used to identify
the implementation of the backend and instantiate the class
provided thanks to <code>BackendFactories</code>.</p>
</li>
<li><p><code>.requestLogin()</code> was not called as expected on minified builds. [Valentin Lab]</p>
<p>When code is minified detection of exception using the
<code>constructor.name</code> is deemed to fail. A second problem was
duplicate (!) declaration of exceptions.</p>
</li>
<li><p>Avoid exception when trying to <code>.makeRecipients()</code> in a backend where we don&#39;t have an account. [Valentin Lab]</p>
</li>
<li><p>Reflect package name change. [Valentin Lab]</p>
</li>
</ul>

<a href="#0017-2021-11-17" id="0017-2021-11-17" style="color: inherit; text-decoration: none;">
  <h2>0.0.17 (2021-11-17)</h2>
</a>

<a href="#new-1" id="new-1" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Provide a <code>.requestLocalPassword()</code> callback for client app. [Valentin Lab]</p>
<p>This will allow backends to query user through client app UI for a
local only password. This password is meant to stay on the device
the app is running, and is typically asked before actually paying.
It could also be asked before any administrative task.</p>
</li>
<li><p>Externalize currency backends, <code>cyclos</code> code exported to <code>lokapi-backend-cyclos</code> [Valentin Lab]</p>
</li>
<li><p>Add <code>markBackend</code> boolean if we have more than one payment backend. [Valentin Lab]</p>
<p>This is meant to be used in widgets receiving Recipients to know if
they should display some information about the payment
backend.</p>
</li>
<li><p>Support for response header querying. [Valentin Lab]</p>
</li>
<li><p>Added support of <code>http</code>, port in node&#39;s <code>httpRequest</code> implementation example. [Valentin Lab]</p>
</li>
</ul>

<a href="#changes-1" id="changes-1" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li><p>Specify a little more <code>ITransaction</code> [Valentin Lab]</p>
<p>In particular <code>.amount</code> is a string, and <code>.date</code> is a javascript
<code>Date</code> object. Removed <code>relatedKind</code> and <code>kind</code> as these are
directly coming out from cyclos and didn&#39;t find any direct use yet
in client app.</p>
</li>
</ul>

<a href="#fix-1" id="fix-1" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li><p><code>.getTransactions()</code> support for complete and correct sorted access. [Valentin Lab]</p>
<p>Transactions are correctly be sorted between backends, accounts.
Internal requests are parallel when possible or useful.  Usage is an
AsyncGenerator that allows client app to request as many as needed to
implement any type of paging or infinite scrolling independantly from
the implementation of the backends that can focus on the best strategy
to optimize requesting.</p>
</li>
<li><p>Debounce <code>getBackendCredentials</code> and <code>getBackends</code> [Valentin Lab]</p>
<p>Client app may be inducing several call to these entrypoints at
once. By storing and returning the ongoing promise, we make sure
to avoid duplicating network requests.</p>
</li>
<li><p>Convert incorrect usage of undefined <code>reject()</code> to <code>throw new</code> [Valentin Lab]</p>
<p>This concerns only the @nativescript example implementation.</p>
</li>
<li><p><code>persistentStorage</code> implementation example for node would output json, not string. [Valentin Lab]</p>
<p>Indeed, in current implementation of <code>vue-cookie-next</code>, string
output is automatically converted (with <code>JSON.parse(..)</code>) if it
starts with a <code>{</code> . This breaks expectation of current
<code>persistentStorage</code> interface.</p>
</li>
<li><p>Don&#39;t stringify if sending data is already a string. [Valentin Lab]</p>
</li>
</ul>

<a href="#0016-2021-09-08" id="0016-2021-09-08" style="color: inherit; text-decoration: none;">
  <h2>0.0.16 (2021-09-08)</h2>
</a>

<a href="#new-2" id="new-2" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Add <code>.searchProRecipients()</code> and fix <code>.searchRecipients()</code> [Valentin Lab]</p>
<p>These both function are temporarily provided to search on professional
and non-professional recipients. Note that the internal logic is
currently taken to the odoo side. Paging is temporarily disabled.</p>
</li>
</ul>

<a href="#changes-2" id="changes-2" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li><p>Upgrade to <code>lokAPI.searchRecipients()</code> [Valentin Lab]</p>
<p>It&#39;ll:</p>
<ul>
<li>return all favorite recipients if search string is empty</li>
<li>always sort results by putting favorite first</li>
</ul>
</li>
</ul>

<a href="#fix-2" id="fix-2" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li><p>Catch odoo unauthorized HTML <code>HttpErrors</code> as expected. [Valentin Lab]</p>
</li>
<li><p><code>lokAPI.{,$}get(..)</code> query-string management support for objects. [Valentin Lab]</p>
</li>
</ul>

<a href="#0014-2021-08-04" id="0014-2021-08-04" style="color: inherit; text-decoration: none;">
  <h2>0.0.14 (2021-08-04)</h2>
</a>

<a href="#new-3" id="new-3" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Add <code>lokAPI.getRecipientsFromUrl(..)</code> support. [Valentin Lab]</p>
</li>
<li><p>Add <code>.getCreditUrl()</code> support to accounts. [Valentin Lab]</p>
</li>
</ul>

<a href="#changes-3" id="changes-3" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li>Using new api GET instead of POST for <code>partner_search</code> [Valentin Lab]</li>
</ul>

<a href="#fix-3" id="fix-3" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li><p>Request login when cyclos backend&#39;s token incorrect also. [Valentin Lab]</p>
</li>
<li><p><code>.{,$}get(..)</code> support for array data values. [Valentin Lab]</p>
</li>
</ul>

<a href="#0013-2021-07-24" id="0013-2021-07-24" style="color: inherit; text-decoration: none;">
  <h2>0.0.13 (2021-07-24)</h2>
</a>

<a href="#new-4" id="new-4" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>API changes around object-like usage. [Valentin Lab]</p>
<p>Please note that:</p>
<ul>
<li><p><code>lokAPI.searchRecipient()</code> was renamed
<code>lokAPI.searchRecipients()</code> (added an &#39;s&#39;)</p>
</li>
<li><p><code>lokAPI.getUserInfo()</code> was renamed <code>lokAPI.getMyContact()</code></p>
<p>This method doesn&#39;t take any argument anymore. We&#39;ll introduce a
<code>lokAPI.getContact()</code> when it&#39;ll appears in user stories.</p>
</li>
<li><p><code>lokAPI.transfer(recipient, amount, desc)</code> was moved to
<code>recipient.transfer(amount, desc)</code></p>
<p>Note that an <code>IRecipient</code> is an <code>IContact</code>, but not the reverse,
so you can use <code>.transfer()</code> only on <code>IRecipient</code>&#39;s object.</p>
</li>
<li><p><code>lokAPI.{set,unset,toggle}Favorite(contact)</code> were moved to
<code>contact.{set,unset,toggle}Favorite()</code>.</p>
<p>Note that an <code>IRecipient</code> is an <code>IContact</code>, so you can use these
on both objects.</p>
</li>
</ul>
</li>
</ul>

<a href="#0012-2021-07-23" id="0012-2021-07-23" style="color: inherit; text-decoration: none;">
  <h2>0.0.12 (2021-07-23)</h2>
</a>

<a href="#new-5" id="new-5" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p><code>lokAPI.{unset,set,toggle}Favorite()</code> implemented with API 3. [Valentin Lab]</p>
<p>This API is more efficient and allow to force set/unset. We are keeping
the <code>toggle</code> for lib users.</p>
</li>
<li><p>Add <code>http</code> support and port specification. [Valentin Lab]</p>
</li>
</ul>

<a href="#0011-2021-07-21" id="0011-2021-07-21" style="color: inherit; text-decoration: none;">
  <h2>0.0.11 (2021-07-21)</h2>
</a>

<a href="#new-6" id="new-6" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li>Add ``lokapi.toggleFavorite(..)` [Valentin Lab]</li>
</ul>

<a href="#changes-4" id="changes-4" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li><p>Make <code>.getUserInfo()</code> without argument return currently logged in user info. [Valentin Lab]</p>
<p>This will get important when using only the session token and needing
to get back some information. We don&#39;t have our own <code>userId</code>.</p>
</li>
</ul>

<a href="#0010-2021-07-08" id="0010-2021-07-08" style="color: inherit; text-decoration: none;">
  <h2>0.0.10 (2021-07-08)</h2>
</a>

<a href="#changes-5" id="changes-5" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li>Add doc for <code>getTransactions()</code> [Valentin Lab]</li>
</ul>

<a href="#009-2021-07-08" id="009-2021-07-08" style="color: inherit; text-decoration: none;">
  <h2>0.0.9 (2021-07-08)</h2>
</a>

<a href="#new-7" id="new-7" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li>Add <code>.getTransactions()</code> with cyclos implementation. [Valentin Lab]</li>
</ul>

<a href="#008-2021-07-08" id="008-2021-07-08" style="color: inherit; text-decoration: none;">
  <h2>0.0.8 (2021-07-08)</h2>
</a>

<a href="#new-8" id="new-8" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Add <code>lokAPI.transfer(..)</code> to management payment. [Valentin Lab]</p>
</li>
<li><p>Add <code>LokAPI.searchRecipient(..)</code> [Valentin Lab]</p>
</li>
</ul>

<a href="#007-2021-07-08" id="007-2021-07-08" style="color: inherit; text-decoration: none;">
  <h2>0.0.7 (2021-07-08)</h2>
</a>

<a href="#new-9" id="new-9" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Compatibility with odoo server version 2. [Valentin Lab]</p>
</li>
<li><p>Catch HTML dev errors of odoo API. [Valentin Lab]</p>
</li>
<li><p>Add persistent session management. [Valentin Lab]</p>
</li>
<li><p><code>JsonRESTClientAbstract</code> support passing data as querystring when using <code>GET</code> method. [Valentin Lab]</p>
</li>
</ul>

<a href="#changes-6" id="changes-6" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li>Refactor down the <code>apiToken</code> mecanism. [Valentin Lab]</li>
</ul>

<a href="#fix-4" id="fix-4" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li>Authentication state incorrectly checked. [Valentin Lab]</li>
</ul>

<a href="#006-2021-07-05" id="006-2021-07-05" style="color: inherit; text-decoration: none;">
  <h2>0.0.6 (2021-07-05)</h2>
</a>

<a href="#changes-7" id="changes-7" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li>Prefer <code>getMethod()</code> syntax to getters as those will be promises. [Valentin Lab]</li>
</ul>

<a href="#fix-5" id="fix-5" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li>Add example with arguments in documents. [Valentin Lab]</li>
</ul>

<a href="#005-2021-07-05" id="005-2021-07-05" style="color: inherit; text-decoration: none;">
  <h2>0.0.5 (2021-07-05)</h2>
</a>

<a href="#new-10" id="new-10" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Provide advanced <code>get</code>, <code>post</code>, <code>put</code>, <code>delete</code> helpers on <code>OdooRESTAbstract</code> with doc. [Valentin Lab]</p>
</li>
<li><p>Can set token directly to access authenticated endpoints. [Valentin Lab]</p>
<p>This will allow to authenticate without login and password, but
using only the =apiToken=.</p>
</li>
<li><p>Ignore but log attempts to load a missing backend. [Valentin Lab]</p>
</li>
</ul>

<a href="#changes-8" id="changes-8" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li>Provide convenience method to request on all backends. [Valentin Lab]</li>
</ul>

<a href="#fix-6" id="fix-6" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li>Move level of headings up one. [Valentin Lab]</li>
</ul>

<a href="#004-2021-07-01" id="004-2021-07-01" style="color: inherit; text-decoration: none;">
  <h2>0.0.4 (2021-07-01)</h2>
</a>

<a href="#new-11" id="new-11" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Ignore but log attempts to load a missing backend. [Valentin Lab]</p>
</li>
<li><p>Manage API version information. [Valentin Lab]</p>
<p>For now, we&#39;ll only issue a warning in console</p>
</li>
<li><p>Updated to new api version 1. [Valentin Lab]</p>
</li>
</ul>

<a href="#changes-9" id="changes-9" style="color: inherit; text-decoration: none;">
  <h3>Changes</h3>
</a>
<ul>
<li>Changing from mixin to abstract class model. [Valentin Lab]</li>
</ul>

<a href="#fix-7" id="fix-7" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li><p>Still need <code>apiToken</code> [Valentin Lab]</p>
<p>We&#39;ll be able to remove <code>apiToken</code> when client will not
need to use it.</p>
</li>
</ul>

<a href="#003-2021-06-30" id="003-2021-06-30" style="color: inherit; text-decoration: none;">
  <h2>0.0.3 (2021-06-30)</h2>
</a>

<a href="#new-12" id="new-12" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Manage API version information. [Valentin Lab]</p>
<p>For now, we&#39;ll only issue a warning in console</p>
</li>
<li><p>Updated to new api version 1. [Valentin Lab]</p>
</li>
</ul>

<a href="#fix-8" id="fix-8" style="color: inherit; text-decoration: none;">
  <h3>Fix</h3>
</a>
<ul>
<li><p><code>odoo</code> property should be public. [Valentin Lab]</p>
<p>As we removed delegations to odoo, we expect API client to use this
attribute.</p>
</li>
</ul>

<a href="#002-2021-06-27" id="002-2021-06-27" style="color: inherit; text-decoration: none;">
  <h2>0.0.2 (2021-06-27)</h2>
</a>

<a href="#new-13" id="new-13" style="color: inherit; text-decoration: none;">
  <h3>New</h3>
</a>
<ul>
<li><p>Add backends, accounts, balance and symbol. [Valentin Lab]</p>
</li>
<li><p>Store <code>accounts</code> information upon authenticate. [Valentin Lab]</p>
</li>
</ul>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class=" tsd-kind-namespace"><a href="modules/RestExc.html">Rest<wbr/>Exc</a></li><li class=" tsd-kind-namespace"><a href="modules/e.html">e</a></li><li class=" tsd-kind-namespace"><a href="modules/t.html">t</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/LokAPIAbstract.html" class="tsd-kind-icon">LokAPIAbstract</a></li></ul></nav></div></div></div><footer class=""><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li><li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="overlay"></div><script src="assets/main.js"></script></body></html>